#!/usr/bin/env python


from bc_client import Metrics
from bc_client import Customers
from bc_client import Tariffs
from bc_client import Rates

from bc import log
import uuid
import random



LOG = log.logger("unittests", type='stderr', level='debug', init=True)
host = 'localhost:10004'
auth = {'role':'admin','secret':'qwerty'}


def process_metrics():
	metrics = [
		{ 'id': 'os_types',                  'formula': 'unit',  'type': 'time',        'aggregate': 1 },
		{ 'id': 'service_monitoring',        'formula': 'unit',  'type': 'time',        'aggregate': 1 },
		{ 'id': 'volume_bytes',              'formula': 'speed', 'type': 'bytes-usage', 'aggregate': 0 },
		{ 'id': 'snapshot_bytes',            'formula': 'speed', 'type': 'bytes-usage', 'aggregate': 0 },
		{ 'id': 'fs_bytes',                  'formula': 'speed', 'type': 'bytes-usage', 'aggregate': 0 },
		{ 'id': 'fs_get',                    'formula': 'unit',  'type': 'count',       'aggregate': 1 },
		{ 'id': 'fs_put',                    'formula': 'unit',  'type': 'count',       'aggregate': 1 },
		{ 'id': 'ipaddr_reserve',            'formula': 'time',  'type': 'time-usage',  'aggregate': 0 },
		{ 'id': 'ipaddr_use',                'formula': 'time',  'type': 'time-usage',  'aggregate': 0 },
		{ 'id': 'traffic_region_incoming',   'formula': 'unit',  'type': 'bytes',       'aggregate': 1 },
		{ 'id': 'traffic_region_outgoing',   'formula': 'unit',  'type': 'bytes',       'aggregate': 1 },
		{ 'id': 'traffic_external_incoming', 'formula': 'unit',  'type': 'bytes',       'aggregate': 1 },
		{ 'id': 'traffic_external_outgoing', 'formula': 'unit',  'type': 'bytes',       'aggregate': 1 },
	]
	cl_metrics = Metrics(host, auth, 30)
	for o in metrics:
		cl_metrics.metricAdd(o)


def process_customers():
	customers = [
		{
			'login':          'google.com',
			'name_short':     'Google',
			'name_full':      'Google OOO (Moscow)',
			'comment':        'Important client',
#			'tariff_id':      '',
			'contact_person': 'Ted Person',
			'contact_email':  'ted.person@gmail.com',
#			'contact_phone':  '',
			'wallet':         1234567890,
			'wallet_mode':    'limit',
		},
		{
			'login':          'testy.org',
			'name_short':     'Test',
			'name_full':      'Test Inc.',
			'comment':        'Simple client',
			'wallet_mode':    'unlimit',
		}
	]
	cl_customers = Customers(host, auth, 30)
	for o in customers:
		cl_customers.customerAdd(o)


def process_tariffs():
	internal = {
		'id': '*',
		'name': 'Service tariff',
		'description': 'This is service tariff record is not for ordinary customers'
	}
	cl_tariffs = Tariffs(host, auth, 30)
	cl_tariffs.tariffAddInternal(internal)

	tariffs = [
		{
			'name': 'Simple testing',
			'description': 'This is try-buy tariff for new customers'
		},
		{
			'name': 'Big rich man',
			'description': 'This tariff for big customers'
		},
		{
			'name': 'Hungry student',
			'description': 'This tariff for startups and little companies'
		}
	]
	for o in tariffs:
		cl_tariffs.tariffAdd(o)


def process_rates():
	tariffIds = [i['id'] for i in Tariffs(host, auth, 30).tariffList()['tariffs']]
	metricIds = [i['id'] for i in Metrics(host, auth, 30).metricList()['metrics']]

	cl_rates = Rates(host, auth, 30)

	for tariff in tariffIds:
		for metric in metricIds:
			cl_rates.rateAdd({
				'description':  str(uuid.uuid4()),
				'metric_id':    metric,
				'tariff_id':    tariff,
				'rate':         long(random.randint(10**3, 10**10)),
				'currency':     'USD',
				})

try:
	process_metrics()
	process_customers()
	process_tariffs()
	process_rates()

except Exception, e:
	print 'Error:', e
